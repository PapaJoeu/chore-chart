<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Chore Chart Generator (12×18 print)</title>
<style>
  /* --- Print sizing --- */
  @page { size: 12in 18in; margin: 0.5in; }
  html, body { height: 100%; }
  body {
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    margin: 0;
    background: #fff;
    color: #111;
  }

  /* --- Layout --- */
  .container { padding: 0.25in; display: flex; flex-direction: column; gap: 0.25in; }
  header { display: flex; justify-content: space-between; align-items: flex-end; gap: 1rem; }
  h1 { font-size: 44pt; line-height: 1; margin: 0; font-weight: 800; letter-spacing: -0.5px; }
  .daterange { font-size: 20pt; font-weight: 600; opacity: 0.85; }
  .controls { display: flex; gap: 0.5rem; flex-wrap: wrap; }
  button { font-size: 16pt; padding: 0.4rem 0.7rem; border-radius: 12px; border: 2px solid #111; background: #f7f7f7; cursor: pointer; }
  button:hover { background: #eee; }

  /* --- Legend --- */
  .legend { font-size: 16pt; display: flex; gap: 1.2rem; flex-wrap: wrap; }
  .legend .swatch { display: inline-flex; align-items: center; gap: 0.4rem; }
  .na-square { width: 28pt; height: 28pt; border: 2px solid #aaa; background: #e9e9e9; display: inline-block; }
  .box { width: 28pt; height: 28pt; border: 3px solid #111; display: inline-block; }

  /* --- Table --- */
  .grid { width: 100%; border-collapse: collapse; table-layout: fixed; }
  .grid th, .grid td { border: 2px solid #000; }
  .grid thead th { font-size: 18pt; padding: 0.25in 0.15in; background: #f2f2f2; }
  .grid thead .dow { font-weight: 800; font-size: 20pt; display: block; }
  .grid thead .date { font-weight: 600; opacity: 0.9; font-size: 16pt; display: block; }

  .col-category { width: 16%; }
  .col-task { width: 24%; }
  .col-day { width: calc(60% / 7); }

  .category { font-size: 22pt; font-weight: 800; padding: 0.2in 0.15in; background: #fafafa; }
  .task { font-size: 20pt; font-weight: 600; padding: 0.18in 0.12in; }
  .cell { height: 34pt; text-align: center; }
  .cell > .box, .cell > .na-square { vertical-align: middle; }

  /* thicker separators between categories */
  .sep { border-top: 6px solid #000 !important; }

  /* Print optimizations */
  @media print {
    .controls { display: none; }
    button { display: none; }
    .container { padding: 0; }
  }
</style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1>Chore Chart</h1>
        <div class="daterange" id="daterange">Week of —</div>
      </div>
      <div class="controls">
        <button id="prevSundayBtn" title="Build week starting previous Sunday">Previous Sunday</button>
        <button id="nextSundayBtn" title="Build week starting upcoming Sunday">Next Sunday</button>
        <button id="printBtn">Print</button>
      </div>
    </header>

    <div class="legend" id="legend"></div>

    <table class="grid" id="grid"></table>
  </div>

  <!-- Editable CONFIG (single place to add/modify chores) -->
  <script id="chore-config" type="application/json">{
    "legend": {"D":"Daily","S":"Weekly","SWF":"Sun/Wed/Fri","M":"Monthly"},
    "defaults": {"weeklyDay":"Sunday","swfDays":["Sunday","Wednesday","Friday"],"monthlyDay":"Sunday"},
    "chores": [
      {"category":"Priority","name":"Dishes to Kitchen","rate":"D"},
      {"category":"Priority","name":"Clothes to Hampers","rate":"D"},
      {"category":"Priority","name":"Put Food Away","rate":"D"},
      {"category":"Priority","name":"Hang Up Backs","rate":"D"},

      {"category":"Bedroom","name":"Make Bed","rate":"D"},
      {"category":"Bedroom","name":"Change Sheets","rate":"S","days":["Sunday"]},

      {"category":"Laundry","name":"Move Clean Laundry","rate":"D"},
      {"category":"Laundry","name":"Start New Load","rate":"D"},
      {"category":"Laundry","name":"Fold Laundry","rate":"D"},
      {"category":"Laundry","name":"Wash Sheets","rate":"S","days":["Sunday"]},

      {"category":"Kitchen","name":"Tidy Snack Station","rate":"D"},
      {"category":"Kitchen","name":"Get New Mugs","rate":"D"},
      {"category":"Kitchen","name":"Empty Fridge","rate":"M"},
      {"category":"Kitchen","name":"Refill Britta","rate":"SWF"},
      {"category":"Kitchen","name":"Replenish Drinks","rate":"SWF"},
      {"category":"Kitchen","name":"Update Grocery List","rate":"SWF"},

      {"category":"Bathroom","name":"Clear off Counters","rate":"D"},
      {"category":"Bathroom","name":"Toilet Bowl","rate":"S"},
      {"category":"Bathroom","name":"Toss Out Old Bottles","rate":"S"},

      {"category":"Trash","name":"Bathroom Trash","rate":"SWF"},
      {"category":"Trash","name":"Bedroom Trash","rate":"D"},
      {"category":"Trash","name":"Living Room Trash","rate":"D"},
      {"category":"Trash","name":"Take Trash To Curb","rate":"M"},

      {"category":"Chata","name":"Empty Litterbox","rate":"S"},
      {"category":"Chata","name":"Check Food","rate":"SWF"},
      {"category":"Chata","name":"Check Water","rate":"SWF"},
      {"category":"Chata","name":"Trim Claws","rate":"S"},
      {"category":"Chata","name":"Change Filter","rate":"M"},

      {"category":"Plants","name":"Water Small Plants","rate":"S"},
      {"category":"Plants","name":"Fill Humidifier","rate":"D"},

      {"category":"Floors","name":"Sweep","rate":"D"},
      {"category":"Floors","name":"Mop","rate":"S"},

      {"category":"Office","name":"Declutter Desks","rate":"D"},
      {"category":"Office","name":"Review Calendar","rate":"D"},
      {"category":"Office","name":"Review To Do","rate":"D"}
    ]
  }</script>

  <script>
  // ---------- Utility date helpers ----------
  const DAY_NAMES = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];

  function startOfPreviousSunday(fromDate = new Date()) {
    const d = new Date(fromDate);
    const delta = d.getDay(); // 0..6 (0=Sun)
    d.setDate(d.getDate() - delta); // go back to Sunday of this week
    // If today is Sunday, "previous Sunday" means 7 days earlier
    if (fromDate.getDay() === 0) d.setDate(d.getDate() - 7);
    d.setHours(0,0,0,0);
    return d;
  }

  function startOfNextSunday(fromDate = new Date()) {
    const d = new Date(fromDate);
    const delta = (7 - d.getDay()) % 7; // days until next Sunday (0 if Sunday)
    d.setDate(d.getDate() + (delta === 0 ? 7 : delta));
    d.setHours(0,0,0,0);
    return d;
  }

  function addDays(date, n) { const d = new Date(date); d.setDate(d.getDate()+n); return d; }
  function fmtDate(date) {
    return date.toLocaleDateString(undefined, { month: 'short', day: 'numeric' });
  }

  // Compute first weekday-of-month date for given weekday name
  function firstWeekdayOfMonth(year, monthIndex0, weekdayName) {
    const targetDow = DAY_NAMES.indexOf(weekdayName);
    if (targetDow < 0) return null;
    const d = new Date(year, monthIndex0, 1);
    const delta = (targetDow - d.getDay() + 7) % 7;
    d.setDate(1 + delta);
    d.setHours(0,0,0,0);
    return d;
  }

  // ---------- Data load ----------
  function loadConfig() {
    const node = document.getElementById('chore-config');
    try { return JSON.parse(node.textContent); } catch (e) { alert('Invalid config JSON'); throw e; }
  }

  // Decide if chore applies to a given date based on rate and optional days
  function appliesOn(chore, date, weekStart, defaults) {
    const dowName = DAY_NAMES[date.getDay()];
    const rate = (chore.rate || '').toUpperCase();

    if (rate === 'D') return true;

    if (rate === 'S') {
      const day = (chore.days && chore.days[0]) || defaults.weeklyDay || 'Sunday';
      return dowName === day;
    }

    if (rate === 'SWF') {
      const days = (chore.days && chore.days.length ? chore.days : defaults.swfDays) || ['Sunday','Wednesday','Friday'];
      return days.includes(dowName);
    }

    if (rate === 'M' || rate === 'MONTHLY') {
      const monthAnchorDay = (chore.days && chore.days[0]) || defaults.monthlyDay || 'Sunday';
      const anchor = firstWeekdayOfMonth(weekStart.getFullYear(), weekStart.getMonth(), monthAnchorDay);
      const weekEnd = addDays(weekStart, 6);
      return +date === +anchor && anchor >= weekStart && anchor <= weekEnd;
    }

    return false; // unknown rate => treat as N/A
  }

  function groupByCategory(chores) {
    const map = new Map();
    for (const c of chores) {
      if (!map.has(c.category)) map.set(c.category, []);
      map.get(c.category).push(c);
    }
    return [...map.entries()].map(([category, items]) => ({ category, items }));
  }

  // ---------- Renderers ----------
  function renderLegend(cfg) {
    const wrap = document.getElementById('legend');
    wrap.innerHTML = '';
    const entries = Object.entries(cfg.legend || {});
    for (const [code, label] of entries) {
      const el = document.createElement('div');
      el.className = 'swatch';
      const sample = document.createElement('span');
      sample.className = code === 'NA' ? 'na-square' : 'box';
      el.appendChild(sample);
      const text = document.createElement('span');
      text.textContent = `${code} — ${label}`;
      el.appendChild(text);
      wrap.appendChild(el);
    }
    const na = document.createElement('div');
    na.className = 'swatch';
    const naSq = document.createElement('span');
    naSq.className = 'na-square';
    na.appendChild(naSq);
    const naTxt = document.createElement('span');
    naTxt.textContent = 'N/A';
    na.appendChild(naTxt);
    wrap.appendChild(na);
  }

  function buildWeek(start) {
    const dates = Array.from({length:7}, (_,i)=> addDays(start, i));
    const cfg = loadConfig();
    const grouped = groupByCategory(cfg.chores);

    // header range label
    const range = `${fmtDate(dates[0])} – ${fmtDate(dates[6])}`;
    document.getElementById('daterange').textContent = `Week of ${fmtDate(dates[0])} (${range})`;

    renderLegend(cfg);

    const tbl = document.getElementById('grid');
    tbl.innerHTML = '';

    // Build header row
    const thead = document.createElement('thead');
    const hr = document.createElement('tr');

    const thCat = document.createElement('th'); thCat.className = 'col-category'; thCat.textContent = 'Category'; hr.appendChild(thCat);
    const thTask = document.createElement('th'); thTask.className = 'col-task'; thTask.textContent = 'Chore'; hr.appendChild(thTask);

    for (const d of dates) {
      const th = document.createElement('th'); th.className = 'col-day';
      const dow = document.createElement('span'); dow.className = 'dow'; dow.textContent = DAY_NAMES[d.getDay()].slice(0,3).toUpperCase();
      const dd = document.createElement('span'); dd.className = 'date'; dd.textContent = fmtDate(d);
      th.appendChild(dow); th.appendChild(dd); hr.appendChild(th);
    }
    thead.appendChild(hr);

    const tbody = document.createElement('tbody');

    grouped.forEach((grp, idx) => {
      grp.items.forEach((chore, j) => {
        const tr = document.createElement('tr');
        if (j === 0) tr.classList.add('sep');

        // Category cell (only once per group – but to keep table simple/printable we repeat with bold)
        const tdCat = document.createElement('td'); tdCat.className = 'category'; tdCat.textContent = grp.category; tr.appendChild(tdCat);
        const tdTask = document.createElement('td'); tdTask.className = 'task'; tdTask.textContent = chore.name; tr.appendChild(tdTask);

        dates.forEach(d => {
          const td = document.createElement('td'); td.className = 'cell';
          const ok = appliesOn(chore, d, dates[0], cfg.defaults || {});
          const box = document.createElement('span');
          box.className = ok ? 'box' : 'na-square';
          td.appendChild(box);
          tr.appendChild(td);
        });

        tbody.appendChild(tr);
      });
    });

    thead.appendChild(hr);
    tbl.appendChild(thead);
    tbl.appendChild(tbody);
  }

  // ---------- Init & controls ----------
  function init() {
    const prevBtn = document.getElementById('prevSundayBtn');
    const nextBtn = document.getElementById('nextSundayBtn');
    const printBtn = document.getElementById('printBtn');

    prevBtn.addEventListener('click', () => buildWeek(startOfPreviousSunday(new Date())));
    nextBtn.addEventListener('click', () => buildWeek(startOfNextSunday(new Date())));
    printBtn.addEventListener('click', () => window.print());

    // Prompt-like default build: show both options; do nothing until user clicks.
    // For convenience, if you want an automatic default, uncomment one of these:
    // buildWeek(startOfNextSunday(new Date()));
    // buildWeek(startOfPreviousSunday(new Date()));
  }

  document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>